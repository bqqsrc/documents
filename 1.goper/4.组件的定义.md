# 组件的定义

在goper中，组件是一个实现了约定的方法的一个结构体类型（或者其他类型）。

goper中一切皆组件，整个goper是由一个一个组件组合而成的，goper的核心代码本身也是几个组件。

---
## Componenter接口
Componenter声明了goper中组件约定的方法：

```
type Componenter interface {
	Awake() error
	Start(*Cycle) error
	Update(*Cycle) (time.Duration, error)
	OnExit(*Cycle) error
	GetKind() Kind
}
```

它声明了5个方法，分别用于实现不同时机组件的逻辑。下面具体介绍这些方法：

- Awake：该方法在组件刚被唤醒时调用，只调用一次，在Start之前调用。该方法不接受任何参数，返回值为error表示是否发生异常，如果没有异常，返回nil。

   该方法的调用与组件顺序无关，各组件是随意调用，因此与组件顺序有关的逻辑不能放在这个方法实现。

   通常该方法用于实现一些组件还没有获取到配置参数时的临时初始化操作。例如日志组件还未获取到配置时，为保证日志得以记录，会赋值一个临时的日志实例，又例如为组件设置默认的配置参数。

- Start：该方法在启动组件时调用，只调用一次，该方法在Awake之后，Update之前调用。 该方法接受一个Cycle指针参数，Cycle是goper中定义的核心结构体之一，这个结构存储了整个goper系统运行过程中需要的东西，后面会具体介绍。该方法返回值为error表示是否发生异常，如果没有异常，返回nil。
   
   通常在该方法做一些组件初始化和启动组件的操作。调用该方法时，组件已经获得了其关注的配置参数值，组件获取配置参数是通过config组件实现的，config是goper的核心组件之一。

	 该方法的调用与modules.go的数组参数有关，会按照该数组索引顺序进行调用。

- Update：该方法在固定的每一轮循环中调用，在Start之后调用，根据返回值决定是否循环调用。该方法接受一个Cycle指针参数。

   该方法返回两个参数，第一个参数为time.Duration，如果其值小于等于0，表示组件的Update不需要循环调用，那么Update只会调用一次，如果其值大于0则会循环调用对应组件的Update。第二个参数为error类型，表示是否发生异常。

	 注意整个系统的Update循环并不是一定存在的，如果所有组件的Update都返回一个小于等于0的Duration，表示所有的组件都不需要Update，循环就会停止。

   通常在该方法实现一些需要循环发生的操作。所有组件启动完成后，每隔一定频率进行一次循环调用该方法。具体间隔多久循环，由core组件获取到的配置决定，默认时间为1秒。

- OnExit：该方法在退出goper系统时调用，做一些必要的保存逻辑。该方法接受一个Cycle指针参数，返回值为error。

   该方法在当前版本还未使用到，属于待完善功能，后续版本将会完善。

- GetKind：该方法返回组件的种类，返回值为组件种类类型。

   组件种类类型定义是uint8的重命名：
	 ```type Kind = uint8```。

	 目前定义了2种种类的组件，ComptBase表示基础组件，ComptHttp表示http组件。

	 ```
	 const (
		ComptBase Kind = iota
		ComptHttp
	)
	 ```
	 
	 用于实现goper基础功能的组件都可以是基础组件，例如核心组件（core）、配置组件（config）、日志组件（log）等都是定义为基础组件。

	 用于实现具体的http逻辑的组件都可以定义为http组件。

所有实现了Componenter声明的接口的类型，都可以作为一个goper组件参与goper系统的运行。事实上，goper中的核心代码也是几个核心组件。

---
## 结语
Goper 中更多是通过继承 Componenter 接口来实现一种具体种类的组件。例如基础组件、http组件等，你也可以定制自己的组件类型。

---
