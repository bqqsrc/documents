# 配置组件

配置组件负责解析 Goper 的配置文件，并将具体的配置值分发到关注的组件中，作为核心组件之一，配置组件是启动 Goper 必不可少的组件之一。

---
## 使用配置组件
### 导入配置组件模块
```
import "github.com/bqqsrc/goper/log"
```

### 添加配置组件到组件列表
```
var compts = []object.Componenter{
	&core.Core{},
	&config.Config{},
	&http.Http{},
	&hcore.HCore{},
	//TODO 其他的组件
}

func main() {
	if err := goper.Launch(compts); err != nil {
		fmt.Printf("goper.Launch err: %v", err)
	}
}
```

### 添加配置文件
添加配置组件后，需要在可执行文件的同级目录下添加配置文件 goper.gs ，这样运行 Goper 后， goper.gs 的配置将会自动的被读取解析后分发到关注的组件中。

---
## 配置组件注册的配置参数
配置组件关注 include 配置项，该配置项解析为一个字符串，代表一个新的配置文件名。当配置组件读取到了新的配置文件时，会先停止当前配置文件的读取，去读取新的配置文件，读取完新的配置文件后再返回读取原来的配置文件。include 字段相当于在配置文件中嵌入另一个配置文件。并且 include 是注册为一个关键字，无论在配置文件中的哪个配置块出现，都会作为一个新的配置文件去读取。

---
## 配置解析规则
配置组件有其自己的一套解析规则：
1. 配置组件只解析基础组件注册的配置指令，因此配置文件 goper.gs 中的所有一级配置字段都是由基础组件所关注的。
2. 基础组件通过CreateConfig方法返回一组配置指令，这组配置指令就是这个组件注册的配置指令，如果配置指令的Config.Value为nil，表示这个配置解析为一个配置块，如果Config.Value为一个具体的变量指针，表示这个配置解析为一个配置项。
3. 一个组件注册的配置块中的配置，都将分发给这个组件，由这个组件决定如何处理这个配置。
4. 如果一个字段被注册为关键字，后面这个字段出现在任何的配置块，他都由注册这个关键字的组件负责处理，即便出现在其他的组件所注册的配置块中。
5. 所有基础组件注册的一级配置字段不能重复。关键字不能和组件的各级配置字段重复。
6. 在配置项中的关键字是无效配置，不会被应用到。

---
## 配置规则的应用
1. 正是由于配置组件可以将一个一级配置解析为一个配置块，这为扩展组件类型提供了基础。当前版本的 http 组件正是基于这一点，实现了 http 组件的分级。http 组件是一个基础组件，它注册了 http 字段的配置指令，将 http 配置解析为一个配置块，因此，配置组件在解析到 http 字段后，会将 http 内部包含的所有配置都分发到 http 组件，而 http 组件会定义一套自己的配置解析规则，将这些从 config 组件获取到的配置再分发到 http 种类的组件中去。
2. 关键字为某些需要固定执行某个操作的配置提供了支持。当前版本的配置组件就注册了一个关键字 include，这个关键字表示引用的其他配置文件，当配置组件在读取到 include 字段时，会把这个字段后的配置解析为一个新的配置文件字符串，然后从这个新的配置文件读取配置，这样可以实现将一些过于复杂的配置文件分离一部分到一个新的配置文件中。

---
## 结语
Goper 的配置组件使用 [gson]()，这是作者为自己实现的一种数据交换格式，用于读取配置文件。如果你不习惯使用，那么可以开发一个新的配置组件，使用自己喜欢的格式化文件，例如json文件、xml文件等等格式的。只要能够遵循以上的解析规则，那么这个配置组件可以无缝替换现有的配置组件。这正是 Goper 组件化带来的一个遍历。

---